/*
 *  jquery-async-navigator - v0.0.12
 *  Provides async navigation to legacy browser request/loading based websites.
 *  https://github.com/electblake/jquery-async-navigator
 *
 *  Made by Blake E
 *  Under MIT License
 */
!function(a,b){"use strict";function c(b,c){this.element=jQuery(b),this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var d="asyncNavigator",e={includeScripts:!1,includeStyles:!0,animate:!0,verbose:!1,beforeAnimate:null,afterAnimate:null};a.extend(c.prototype,{init:function(){this.settings.selector="#"+this.element.attr("id");var a=b._.bind(function(){try{var a=event.state.state;this.settings.verbose&&console.log("poped state",a),a&&this.asyncNextPage(a,{popstate:!0},function(a){a&&console.error(a)})}catch(b){b&&console.log(b)}},this);b.onpopstate=a},asyncNextPage:function(a,c,d){"function"==typeof c&&(d=c,c={}),this.settings.animate&&this.element.animate({opacity:0},1e3),this.getNextPage(a,b._.bind(function(a,b){this.settings.verbose&&console.debug("asyncNavigator nextPage",b),jQuery(this.settings.selector).html(b.main_content),b.body_class&&(jQuery("body")[0].className=b.body_class),b.page_title&&jQuery("html head title").attr("innerHTML",b.page_title),this.settings.includeScripts&&jQuery("body").append(b.scripts),this.settings.includeStyles&&jQuery("body").append(b.styles),this.settings.verbose&&console.log("pushState",{state:b.url}),c&&c.popstate||history.pushState({state:b.url},b.page_title,b.url),this.settings.animate&&this.element.animate({opacity:1},500),d(a)},this))},getNextPage:function(c,d){this.settings.verbose&&console.log("getNextPage",c);var e={url:c};a.ajax({url:c,success:b._.bind(function(b){b=b.replace("<body","<div id='body'"),b=b.replace("</body","</div");var c=a(b),f=c.find(this.settings.selector).attr("innerHTML");f&&f.length>0&&(e.page_title=c.filter("title").text(),e.body_class=c.filter("#body").attr("class"),e.main_content=f,this.settings.includeScripts&&(e.scripts=c.filter("script").toArray()),this.settings.includeStyles&&(e.styles=c.filter("link").toArray())),d(null,e)},this),error:function(a,b,c){this.settings.verbose&&console.log("status",b),d(c)}})}}),a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new c(this,b))})}}(jQuery,window,document);